# Инструкция по развертыванию на Amvera

## Текущее состояние

✅ Amvera remote уже подключен:
```
amvera  https://git.msk0.amvera.ru/andro8461/vgltu-version-2
```

✅ Текущая ветка: `master`

## Решение проблем с аутентификацией

Если вы получили ошибку `fatal: Authentication failed`, попробуйте следующие решения:

### Вариант 1: Использование токена доступа (рекомендуется)

1. Перейдите в панель Amvera → Настройки → Токены доступа
2. Создайте новый токен доступа (если его нет)
3. Используйте токен вместо пароля:

```bash
git push amvera master
# Username: ваш_логин_amvera
# Password: ваш_токен_доступа (не пароль!)
```

### Вариант 2: Включить username в URL

```bash
# Обновите remote с username
git remote set-url amvera https://ваш_логин@git.msk0.amvera.ru/andro8461/vgltu-version-2

# Затем push (потребуется только пароль/токен)
git push amvera master
```

### Вариант 3: Использовать SSH (если настроены ключи)

```bash
# Измените URL на SSH
git remote set-url amvera git@git.msk0.amvera.ru:andro8461/vgltu-version-2.git

# Push через SSH
git push amvera master
```

### Вариант 4: Использовать Git Credential Manager

```bash
# Сохранить учетные данные
git config --global credential.helper manager-core

# Затем попробуйте push снова
git push amvera master
```

## Быстрый деплой

### 1. Проверьте, что все изменения закоммичены

```bash
git status
```

### 2. Добавьте изменения (если есть)

```bash
git add .
git commit -m "Описание изменений"
```

### 3. Отправьте код на Amvera

```bash
git push amvera master
```

При запросе введите:
- **Username**: ваш логин Amvera
- **Password**: ваш токен доступа (не пароль!) или пароль, если токен не используется

## Первый деплой

Если это первый раз, когда вы отправляете код:

1. Убедитесь, что файл `amvera.yaml` создан (уже создан)
2. Убедитесь, что файл `app/config.py` содержит ваш токен бота
3. Выполните:

```bash
git add amvera.yaml
git commit -m "Add Amvera configuration"
git push amvera master
```

## Обновление проекта

После любых изменений в коде:

```bash
# 1. Добавить изменения
git add .

# 2. Создать коммит
git commit -m "Описание изменений"

# 3. Отправить на Amvera
git push amvera master
```

## Важные замечания

⚠️ **Токен бота**: Убедитесь, что файл `app/config.py` с токеном находится на сервере Amvera.
Если вы используете переменные окружения, настройте их в панели Amvera.

⚠️ **База данных**: Файлы `.db` будут создаваться автоматически на сервере.
Убедитесь, что у приложения есть права на запись.

⚠️ **Логи**: Проверяйте логи в панели Amvera для отладки.

## Проверка статуса

После `git push` проверьте:
1. Панель управления Amvera → раздел "Сборка"
2. Убедитесь, что сборка прошла успешно
3. Проверьте логи запуска приложения

## Возможные проблемы

### Ошибка: "branch master not found"
Если ваша основная ветка называется `main`:
```bash
git push amvera main:master
```

### Ошибка сборки
- Проверьте `requirements.txt` - все зависимости должны быть указаны
- Проверьте логи сборки в панели Amvera
- Убедитесь, что `amvera.yaml` корректен

### Бот не запускается
- Проверьте, что токен указан в `app/config.py`
- Проверьте логи приложения в панели Amvera
- Убедитесь, что команда запуска в `amvera.yaml` правильная

## Синхронизация с GitHub

Если вы хотите отправить изменения и на GitHub:

```bash
# После push в Amvera
git push origin master
```

Или можно настроить push в оба репозитория одновременно (см. настройки Git).

