# Восстановление базы данных пользователей на Amvera

## Проблема
При создании новой учетной записи на Amvera база данных пользователей (`/data/users.db`) была потеряна, так как директория `/data` была пустой или пересоздана.

## Решение: Восстановление из локальной копии

### Вариант 1: Загрузка через панель Amvera (Рекомендуется)

1. **Подготовьте файл базы данных:**
   - Убедитесь, что у вас есть локальная копия `users.db` (она должна быть в корне проекта)
   - Если база данных большая, можно сжать её: `gzip users.db` (получится `users.db.gz`)

2. **Загрузите файл в Amvera:**
   - Откройте панель Amvera
   - Перейдите в раздел **"Репозиторий → Data"**
   - Нажмите **"Загрузить файл"** или **"Upload"**
   - Выберите файл `users.db` (или `users.db.gz`, если сжали)
   - Дождитесь завершения загрузки

3. **Проверьте путь:**
   - Убедитесь, что файл находится в `/data/users.db`
   - Если вы загрузили сжатый файл, распакуйте его через терминал Amvera:
     ```bash
     cd /data
     gunzip users.db.gz
     ```

4. **Перезапустите бота:**
   - Перейдите в раздел **"Управление"** (Management)
   - Нажмите **"Перезапустить"** (Restart)

### Вариант 2: Восстановление через терминал Amvera

Если у вас есть доступ к терминалу Amvera:

1. **Подключитесь к терминалу Amvera**

2. **Загрузите файл базы данных:**
   ```bash
   # Перейдите в директорию /data
   cd /data
   
   # Если у вас есть файл на локальной машине, используйте scp или загрузите через веб-интерфейс
   ```

3. **Проверьте права доступа:**
   ```bash
   chmod 644 /data/users.db
   ```

4. **Проверьте, что файл на месте:**
   ```bash
   ls -lh /data/users.db
   ```

### Вариант 3: Автоматическое восстановление (если есть бэкап)

Если у вас настроено автоматическое резервное копирование:

1. Найдите последний бэкап базы данных
2. Загрузите его в `/data/users.db`
3. Перезапустите бота

## Проверка восстановления

После восстановления проверьте логи:

1. В логах должно появиться:
   ```
   [INFO] Используется файл базы данных: /data/users.db
   [INFO] ✅ Инициализировано X активных пользователей для проверки изменений расписания
   [INFO] ✅ Восстановлено X задач ежедневных уведомлений
   ```

2. Проверьте количество пользователей:
   - Запустите бота
   - Используйте админ-команду для проверки количества пользователей (если есть)

## Предотвращение проблемы в будущем

### Настройка автоматического бэкапа

1. **Создайте скрипт бэкапа** (см. `backup_database.py`)

2. **Настройте регулярное резервное копирование:**
   - Используйте cron job на Amvera
   - Или настройте автоматический экспорт через панель Amvera

3. **Храните бэкапы:**
   - Загружайте бэкапы в облачное хранилище (S3, Google Drive и т.д.)
   - Или сохраняйте локально на вашем компьютере

## Важно

- **Директория `/data` на Amvera сохраняется между перезапусками**, но может быть потеряна при:
  - Создании новой учетной записи
  - Удалении приложения
  - Полной пересборке контейнера (если не настроено постоянное хранилище)

- **Всегда делайте бэкапы** перед важными изменениями!

## Контакты

Если проблема не решена, проверьте:
1. Логи бота на наличие ошибок БД
2. Права доступа к файлу `/data/users.db`
3. Наличие свободного места на диске

